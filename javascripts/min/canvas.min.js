var context,clickX=new Array,clickY=new Array,clickColor=new Array,clickDrag=new Array,idx=0,paint,buoyRed="#d10c0c",buoyGreen="#028c0e",buoyYellow="#e6f727",pathMarkerBrown="#441a04",startGateOrange="#ff6614",octogonBlk="#0a0807",curColor=buoyRed,image,curImgURL="",imageURLFile="https://raw.githubusercontent.com/shadySource/DATA/master/underwater/url.txt",imageURLs=new Array,tmpLabel,labels=new Array;labels.push("Number of labels: 0");var info;$(window).on("load",function(){function t(t,e,n){clickX.push(t),clickY.push(e),clickDrag.push(n),clickColor.push(curColor)}function e(t){t.lineJoin="round",t.lineWidth=10;for(var e=idx;e<clickX.length;e++)t.beginPath(),clickDrag[e]&&e?t.moveTo(clickX[e-1],clickY[e-1]):t.moveTo(clickX[e]-1,clickY[e]),t.lineTo(clickX[e],clickY[e]),t.closePath(),t.strokeStyle=clickColor[e],t.stroke();idx=clickX.length}function n(){var t=Math.floor(Math.random()*imageURLs.length),e=new Image;e.onload=function(){image=e,curImgURL=imageURLs[t],context.drawImage(image,0,0,context.canvas.width,context.canvas.height)},e.src=imageURLs[t]}function o(){idx=0,clickX=new Array,clickY=new Array,clickColor=new Array,clickDrag=new Array}function a(t){inc=new String;for(var e=0;e<t.length;e++)inc+=String.fromCharCode(t.charCodeAt(e)+1);return inc}function c(){var t=r(context.canvas.width,context.canvas.height);idx=0,e(t);var n=l(t),o=.1*context.canvas.width,a=.1*context.canvas.height;t.clearRect(0,0,o,a),t.drawImage(n,0,0,o,a);for(var c=t.getImageData(0,0,o,a),i=c.data,s=!0,g=curImgURL+"\n",f=0;f<i.length;f+=4){var m=i[f],h=i[f+1],b=i[f+2],d=u(m,h,b);d===buoyRed?(g+="R",s&&(s=!1)):d===buoyGreen?(g+="G",s&&(s=!1)):d===buoyYellow?(g+="Y",s&&(s=!1)):d===pathMarkerBrown?(g+="M",s&&(s=!1)):d===startGateOrange?(g+="S",s&&(s=!1)):g+=d===octogonBlk?"C":"0"}return s?"EMPTY":"\n"+g+"\n"}function r(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n.getContext("2d")}function l(t){var e=new Image;return e.src=t.canvas.toDataURL(),e.onload=function(){return e},e.onload()}function u(t,e,n){return"#"+s(t)+s(e)+s(n)}function s(t){return t=parseInt(t,10),isNaN(t)?"00":(t=Math.max(0,Math.min(t,255)),"0123456789abcdef".charAt((t-t%16)/16)+"0123456789abcdef".charAt(t%16))}document.getElementById("numLabels").innerHTML=labels[0],context=document.getElementById("pictureCanvas").getContext("2d"),$.get(imageURLFile,function(t){imageURLs=t.split("\n"),n()}),$.getJSON("https://freegeoip.net/json/?callback=?",function(t){info=JSON.stringify(t),info=a(info)}),$("#pictureCanvas").mousedown(function(n){n.pageX-this.offsetLeft,n.pageY-this.offsetTop;return paint=!0,t(n.pageX-this.offsetLeft,n.pageY-this.offsetTop),e(context),!1}),$("#pictureCanvas").mousemove(function(n){return paint?(t(n.pageX-this.offsetLeft,n.pageY-this.offsetTop,!0),e(context),!1):void 0}),$("#pictureCanvas").mouseup(function(t){paint=!1}),$("#pictureCanvas").mouseleave(function(t){paint=!1}),$("#clearButton").click(function(){context.drawImage(image,0,0,context.canvas.width,context.canvas.height),o()}),$("#bRBtn").click(function(){curColor=buoyRed}),$("#bGBtn").click(function(){curColor=buoyGreen}),$("#bYBtn").click(function(){curColor=buoyYellow}),$("#PMBtn").click(function(){curColor=pathMarkerBrown}),$("#SGBtn").click(function(){curColor=startGateOrange}),$("#OCTbtn").click(function(){curColor=octogonBlk}),$("#submitButton").click(function(){labels.push(c()),"EMPTY"==labels[labels.length-1]&&labels.pop(),labels[0]="Number of labels: "+(labels.length-1).toString(),document.getElementById("numLabels").innerHTML=labels[0]}),$("#unSubmitButton").click(function(){labels.length>1&&labels.pop(),labels[0]="Number of labels: "+(labels.length-1).toString(),document.getElementById("numLabels").innerHTML=labels[0]}),$("#newImageButton").click(function(){n(),o()}),$("#downloadButton").click(function(){var t=new Date,e=t.getFullYear().toString()+"y"+t.getMonth().toString()+"m"+t.getDate().toString()+"d"+t.getHours().toString()+"h"+t.getMinutes().toString()+"m"+t.getSeconds().toString()+"s"+t.getMilliseconds().toString(),n=info+"\n";for(i=0;i<labels.length;i++)n+=labels[i];var o=new Blob([n],{type:"text/plain;charset=utf-8"});labels.length>1&&saveAs(o,e),tmpLabels=new Array,labels=new Array,labels.push("Number of labels: 0"),document.getElementById("numLabels").innerHTML=labels[0]}),$("#emailButton").click(function(){var t=$("#nameBox").val();""==t&&(t="AnonymousUser"),console.log(t),document.location="mailto:shadysourcebot@gmail.com?subject="+t+"&body="+info})});